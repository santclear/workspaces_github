<!DOCTYPE html>
<html>
  <head>
    <!-- Required meta tags-->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!-- Color theme for statusbar -->
    <meta name="theme-color" content="#2196f3">
    <!-- Your app title -->
    <title>My App</title>
    <!-- Path to Framework7 Library CSS, Material Theme -->
    <link rel="stylesheet" href="framework7/css/framework7.material.min.css">
    <!-- Path to Framework7 color related styles, Material Theme -->
    <link rel="stylesheet" href="framework7/css/framework7.material.colors.min.css">
    <!-- Path to your custom app styles-->
    <link rel="stylesheet" href="framework7/css/my-app.css">
	<style type='text/css'>
	    .item-text {
			max-width: 150px;
			}
	</style>
	</head>
  <body class='theme-green'>
    <!-- Views -->
    <div class="views">
      <!-- Your main view, should have "view-main" class -->
      <div class="view view-main">
        <!-- Pages container, because we use fixed navbar and toolbar, it has additional appropriate classes-->
        <div class="pages navbar-fixed toolbar-fixed">
          <!-- Page, "data-page" contains page name -->
          <div data-page="index" class="page">
 
            <!-- Top Navbar. In Material theme it should be inside of the page-->
            <div class="navbar">
              <div class="navbar-inner">
                <div class="center">DevMedia App - Tarefas</div>
              </div>
            </div>
 
            <!-- Bottom Toolbar. In Material theme it should be inside of the page-->
            <div class="toolbar">
              <div class="toolbar-inner">
                <!-- Toolbar links -->
                <a href="#" class="link">Link 1</a>
                <a href="#" class="link">Link 2</a>
              </div>
            </div>
 
            <!-- Scrollable page content -->
            <div class="page-content">
				<div class="content-block-title">Lista de Tarefas</div>
				<div class="list-block media-list" id='item-tarefa'>
				  <ul>
					<li style='display:block' id='primeiro'>
					  <label class="label-checkbox item-content">
						<input type="checkbox" name="my-checkbox" class='check-tarefa' id='tarefa0'>
						<div class="item-media"><i class="icon icon-form-checkbox"></i></div>
						<div class="item-inner">
						  <div class="item-title-row">
							<div class="item-title">Facebook</div>
							<div class="item-after">
								<a href='#' class="button button-fill button-raised btn-ver">
									<img src='img/eye.png'/>
								</a>
								<div class="item-after">
									<a href='#' class="button button-fill button-raised btn-remover" style='padding-top:5px'>
										<img src='img/remove.png'/>
									</a>
								</div>
							</div>
						  </div>
						  <div class="item-text"></div>
						</div>
					  </label>
					</li>
				  </ul>
				</div>
			
               <div class="content-block">
					<div class="list-block">
						<div class="item-content">
						<div class="item-inner">
						  <div class="item-input">
							<input type='text' id='new-tarefa' placeholder='Nova tarefa...'/>
						  </div>
						</div>
						</div>
						<div class="item-content">
							<div class="item-inner">
								<div class="item-input">
								  <textarea id='descricao' placeholder='Descrição...'></textarea>
								</div>
							</div>
						</div>
					</div>
					
					Restam <span id='cont'></span> chars.
					
					<a href='#' class="button button-fill button-raised" onclick='criarNovaTarefa()'>Add Tarefa</a>
				</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Path to Framework7 Library JS-->
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/jquery-2.2.3.js"></script>
    <script type="text/javascript" src="framework7/js/framework7.min.js"></script>
    <!-- Path to your app js-->
    <script type="text/javascript" src="framework7/js/my-app.js"></script>
    <script type="text/javascript" src="js/jquery.simplyCountable.js"></script>
	<script type="text/javascript">
		$(document).ready(function () {
			configBotoesAcao();
			
			$('#descricao').simplyCountable({
				counter:            '#cont',
				countType:          'characters',
				maxCount:           60,
				strictMax:          true,
				countDirection:     'down'
			});
		});
	
		function criarNovaTarefa() {
			var tarefa = {};
			
			var texto = $('#new-tarefa').val();
			var descricao = $('#descricao').val();
			if (texto != null) {
				if (texto.trim() == '') {
					myApp.alert('A tarefa não pode estar vazia!', 'Alerta', limparCampos);
				} else {
					tarefa = {check: false, texto: texto, descricao: descricao};
					addItemLista(tarefa);
				}
				limparCampos();
			}
		}
		
		var idItem = 0;
		function addItemLista(tarefa) {
			idItem += 1;
			var clone = $('#item-tarefa li#primeiro').clone().removeAttr('id').appendTo('#item-tarefa ul');
			clone.find('.check-tarefa').attr('id', 'tarefa' + idItem).prop('checked', tarefa.check);
			clone.find('.item-title').text(tarefa.texto);
			clone.find('.item-text').text(tarefa.descricao);
			configBotoesAcao();
		}
		
		function configBotoesAcao() {
			// itera por todos os li a partir do #item-tarefa
			$('#item-tarefa li').each(function () {
				var id = $(this).find('.check-tarefa').attr('id');
				// procura o btn-ver, desfaz o clique, depois clica novamente
				$(this).find('.btn-ver').unbind('click').click(function () {
					// a partir do id procurado, busca todo os irmãos para o obter o item-inner, para depois pegar o texto do item
					var texto = $('#' + id).siblings('.item-inner').find('.item-title').text();
					var descricao = $('#' + id).siblings('.item-inner').find('.item-text').text();
					myApp.alert(descricao, texto, limparCampos);
				});
				$(this).find('.btn-remover').unbind('click').click(function () {
					removerItem(id);
				});
			});
		}
		
		function removerItem(idItem) {
			myApp.confirm('Tem certeza que deseja remover essa tarefa?', 'Remover Tarefa', function() {
				$('#' + idItem).parents('li').remove();
			});
		}
		
		function limparCampos() {
			$('#new-tarefa').val('').focus();
			$('#descricao').val('');
		}
	</script>
  </body>
</html>